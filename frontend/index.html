<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SubVeil - Cyber Intelligence Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0f172a;
            --bg-card: #1e293b;
            --bg-sidebar: #0b1120;
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --accent-primary: #3b82f6;
            --accent-secondary: #8b5cf6;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --border: #334155;
            --glow: 0 0 20px rgba(59, 130, 246, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            overflow-x: hidden;
        }

        /* Sidebar */
        .sidebar {
            width: 260px;
            background-color: var(--bg-sidebar);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            padding: 24px;
            position: fixed;
            height: 100vh;
            z-index: 100;
        }

        .logo-area {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            box-shadow: var(--glow);
        }

        .logo-text h1 {
            font-size: 20px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .logo-text p {
            font-size: 11px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .nav-menu {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            border-radius: 8px;
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.2s ease;
            font-size: 14px;
            font-weight: 500;
        }

        .nav-item:hover, .nav-item.active {
            background-color: rgba(59, 130, 246, 0.1);
            color: var(--accent-primary);
        }

        .nav-item.active {
            border-left: 3px solid var(--accent-primary);
        }

        .stats-widget {
            margin-top: auto;
            background: var(--bg-card);
            padding: 16px;
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 13px;
        }

        .stat-label { color: var(--text-secondary); }
        .stat-val { font-weight: 600; font-family: 'JetBrains Mono', monospace; }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 260px;
            padding: 32px;
            max-width: 1600px;
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
        }

        .page-title h2 {
            font-size: 24px;
            font-weight: 600;
        }

        .page-title p {
            color: var(--text-secondary);
            font-size: 14px;
            margin-top: 4px;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(16, 185, 129, 0.1);
            padding: 8px 16px;
            border-radius: 20px;
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background-color: var(--success);
            border-radius: 50%;
            box-shadow: 0 0 10px var(--success);
        }

        .status-text {
            font-size: 12px;
            color: var(--success);
            font-weight: 600;
            text-transform: uppercase;
        }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 24px;
        }

        .panel {
            background-color: var(--bg-card);
            border-radius: 16px;
            border: 1px solid var(--border);
            padding: 24px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .panel-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border);
        }

        .panel-title {
            font-size: 16px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-secondary);
        }

        /* Input Area */
        .search-container {
            position: relative;
            margin-bottom: 24px;
        }

        .search-input {
            width: 100%;
            background: var(--bg-dark);
            border: 2px solid var(--border);
            padding: 16px 16px 16px 50px;
            border-radius: 12px;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: var(--glow);
        }

        .search-icon {
            position: absolute;
            left: 18px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }

        .action-buttons {
            display: flex;
            gap: 12px;
        }

        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            flex: 1;
        }

        .btn-primary:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: var(--bg-dark);
            color: var(--text-secondary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            border-color: var(--text-secondary);
            color: var(--text-primary);
        }

        /* Results Area */
        .results-area {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .results-area.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 24px;
        }

        .data-card {
            background: rgba(15, 23, 42, 0.5);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 16px;
            transition: all 0.2s ease;
        }

        .data-card:hover {
            border-color: var(--accent-primary);
            background: rgba(59, 130, 246, 0.05);
        }

        .data-label {
            font-size: 11px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .data-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            word-break: break-all;
            color: var(--text-primary);
        }

        /* Trust Score Panel */
        .trust-panel {
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .trust-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
        }

        .score-container {
            position: relative;
            width: 160px;
            height: 160px;
            margin: 0 auto 24px;
        }

        .score-ring-bg {
            fill: none;
            stroke: var(--bg-dark);
            stroke-width: 12;
        }

        .score-ring {
            fill: none;
            stroke: var(--accent-primary);
            stroke-width: 12;
            stroke-linecap: round;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
            transition: stroke-dashoffset 1s ease, stroke 0.3s ease;
        }

        .score-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .score-number {
            font-size: 42px;
            font-weight: 700;
            display: block;
            line-height: 1;
        }

        .score-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            margin-top: 4px;
        }

        .risk-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 24px;
        }

        .risk-low { background: rgba(16, 185, 129, 0.15); color: var(--success); border: 1px solid rgba(16, 185, 129, 0.3); }
        .risk-medium { background: rgba(245, 158, 11, 0.15); color: var(--warning); border: 1px solid rgba(245, 158, 11, 0.3); }
        .risk-high { background: rgba(239, 68, 68, 0.15); color: var(--danger); border: 1px solid rgba(239, 68, 68, 0.3); }
        .risk-unknown { background: rgba(148, 163, 184, 0.15); color: var(--text-secondary); border: 1px solid var(--border); }

        .whois-list {
            text-align: left;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .whois-row {
            display: flex;
            justify-content: space-between;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border);
            font-size: 13px;
        }

        .whois-row:last-child { border-bottom: none; }
        .whois-key { color: var(--text-secondary); }
        .whois-val { font-family: 'JetBrains Mono', monospace; text-align: right; }

        /* Loading */
        .loading-overlay {
            display: none;
            margin: 40px 0;
            text-align: center;
        }

        .loading-overlay.active { display: block; }

        .cyber-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid transparent;
            border-top: 3px solid var(--accent-primary);
            border-right: 3px solid var(--accent-secondary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.2);
        }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Responsive */
        @media (max-width: 1024px) {
            .dashboard-grid { grid-template-columns: 1fr; }
        }

        @media (max-width: 768px) {
            .sidebar { display: none; }
            .main-content { margin-left: 0; padding: 16px; }
        }

        /* Deep Scan Styles */
        .view-container { display: none; }
        .view-container.active { display: block; }

        .deep-scan-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        .scan-panel {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .scan-panel:hover {
            border-color: var(--accent-primary);
            box-shadow: var(--glow);
        }

        .scan-panel-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border);
        }

        .scan-panel-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .icon-ssl { background: rgba(16, 185, 129, 0.15); }
        .icon-headers { background: rgba(59, 130, 246, 0.15); }
        .icon-dns { background: rgba(139, 92, 246, 0.15); }
        .icon-tech { background: rgba(245, 158, 11, 0.15); }
        .icon-ports { background: rgba(239, 68, 68, 0.15); }
        .icon-redirect { background: rgba(6, 182, 212, 0.15); }

        .scan-panel-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .scan-panel-subtitle {
            font-size: 11px;
            color: var(--text-secondary);
        }

        .scan-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(51, 65, 85, 0.5);
            font-size: 13px;
        }

        .scan-row:last-child { border-bottom: none; }
        .scan-key { color: var(--text-secondary); }
        .scan-val { 
            font-family: 'JetBrains Mono', monospace; 
            color: var(--text-primary);
            text-align: right;
            max-width: 60%;
            word-break: break-all;
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .badge-success { background: rgba(16, 185, 129, 0.15); color: var(--success); }
        .badge-warning { background: rgba(245, 158, 11, 0.15); color: var(--warning); }
        .badge-danger { background: rgba(239, 68, 68, 0.15); color: var(--danger); }
        .badge-info { background: rgba(59, 130, 246, 0.15); color: var(--accent-primary); }

        .security-grade-display {
            text-align: center;
            padding: 30px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            margin-bottom: 20px;
        }

        .grade-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 48px;
            font-weight: 800;
            border: 4px solid;
        }

        .grade-a { border-color: var(--success); color: var(--success); background: rgba(16, 185, 129, 0.1); }
        .grade-b { border-color: #22c55e; color: #22c55e; background: rgba(34, 197, 94, 0.1); }
        .grade-c { border-color: var(--warning); color: var(--warning); background: rgba(245, 158, 11, 0.1); }
        .grade-d { border-color: #f97316; color: #f97316; background: rgba(249, 115, 22, 0.1); }
        .grade-f { border-color: var(--danger); color: var(--danger); background: rgba(239, 68, 68, 0.1); }

        .findings-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-height: 300px;
            overflow-y: auto;
        }

        .finding-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            background: rgba(15, 23, 42, 0.5);
            border-radius: 8px;
            font-size: 13px;
            border-left: 3px solid;
        }

        .finding-success { border-color: var(--success); }
        .finding-warning { border-color: var(--warning); }
        .finding-danger { border-color: var(--danger); }
        .finding-info { border-color: var(--accent-primary); }

        .port-tag {
            display: inline-block;
            padding: 4px 8px;
            margin: 2px;
            background: rgba(239, 68, 68, 0.15);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 6px;
            font-size: 11px;
            font-family: 'JetBrains Mono', monospace;
            color: var(--danger);
        }

        .port-tag.safe {
            background: rgba(16, 185, 129, 0.15);
            border-color: rgba(16, 185, 129, 0.3);
            color: var(--success);
        }

        .tech-tag {
            display: inline-block;
            padding: 4px 10px;
            margin: 3px;
            background: rgba(139, 92, 246, 0.15);
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 6px;
            font-size: 11px;
            color: var(--accent-secondary);
        }

        .header-check {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 0;
            font-size: 12px;
        }

        .header-check-icon {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
        }

        .check-pass { background: rgba(16, 185, 129, 0.2); color: var(--success); }
        .check-fail { background: rgba(239, 68, 68, 0.2); color: var(--danger); }

        .full-width { grid-column: 1 / -1; }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--bg-dark);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 8px;
        }

        .progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .scan-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px;
            text-align: center;
        }

        .scan-progress-text {
            margin-top: 20px;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .pulse-ring {
            width: 80px;
            height: 80px;
            border: 3px solid var(--accent-primary);
            border-radius: 50%;
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0% { transform: scale(0.9); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.5; }
            100% { transform: scale(0.9); opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="logo-area">
            <div class="logo-icon">üõ°Ô∏è</div>
            <div class="logo-text">
                <h1>SubVeil</h1>
                <p>Intelligence Suite</p>
            </div>
        </div>
        
        <nav class="nav-menu">
            <a href="#" class="nav-item active" data-view="networkanalysis">
                <span>üåê</span> Network Analysis
            </a>
            <a href="#" class="nav-item" data-view="dashboard">
                <span>üìä</span> Dashboard
            </a>
            <a href="#" class="nav-item" data-view="history">
                <span>üìú</span> History
            </a>
            <a href="#" class="nav-item" data-view="settings">
                <span>‚öôÔ∏è</span> Settings
            </a>
        </nav>

        <div class="stats-widget">
            <div class="stat-row">
                <span class="stat-label">Total Scans</span>
                <span class="stat-val" id="totalScans">0</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Success Rate</span>
                <span class="stat-val" id="successRate">100%</span>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Network Analysis View (Combined Scan & Deep Scan) -->
        <div id="networkAnalysisView" class="view-container active">
            <div class="top-bar">
                <div class="page-title">
                    <h2>üåê Network Analysis</h2>
                    <p>URL intelligence, threat assessment, and deep security scanning</p>
                </div>
                <div class="status-indicator">
                    <div class="status-dot"></div>
                    <span class="status-text">System Online</span>
                </div>
            </div>
            <!-- Live Network Analysis Panel -->
            <div class="panel" style="margin-bottom: 32px;">
                <div class="panel-header">
                    <span class="panel-title">Live Network Analysis</span>
                </div>
                <div style="color: var(--text-secondary); font-size: 15px; margin-bottom: 10px;">
                    <b>What is this?</b> This panel simulates real-time network traffic analysis. You'll see the most active protocols, ports, and IP addresses, color-coded for clarity. Hover over each section for more info.
                </div>
                <button id="startLiveBtn" class="btn btn-primary" style="margin-bottom: 18px;">
                    <span>‚ñ∂Ô∏è</span> Start Live Analysis
                </button>
                <div id="liveStats" style="margin-top: 16px; display: none;">
                    <div style="color: var(--text-secondary);">Initializing live network analysis...</div>
                </div>
            </div>
            <div class="dashboard-grid">
                <!-- Left Column: Scan & Results -->
                <div class="left-col">
                    <div class="panel">
                        <div class="panel-header">
                            <span class="panel-title">Target Acquisition</span>
                        </div>
                        <div class="search-container">
                            <span class="search-icon">üîó</span>
                            <input type="text" class="search-input" id="urlInput" placeholder="Enter target URL (e.g., https://example.com)..." autocomplete="off">
                        </div>
                        <div class="action-buttons">
                            <button class="btn btn-primary" id="extractBtn">
                                <span>‚ö°</span> Initiate Scan
                            </button>
                            <button class="btn btn-secondary" id="clearBtn">
                                <span>üóëÔ∏è</span> Clear
                            </button>
                        </div>
                        <div class="loading-overlay" id="loading">
                            <div class="cyber-spinner"></div>
                            <p style="color: var(--text-secondary); font-size: 14px;">Decrypting URL parameters & querying WHOIS database...</p>
                        </div>
                        <div id="error" style="display: none; margin-top: 20px; padding: 12px; background: rgba(239, 68, 68, 0.1); border: 1px solid var(--danger); border-radius: 8px; color: var(--danger); font-size: 14px;"></div>
                    </div>
                    <div class="results-area" id="resultContainer">
                        <div class="panel" style="margin-top: 24px;">
                            <div class="panel-header">
                                <span class="panel-title">Technical Analysis</span>
                            </div>
                            <div style="background: var(--bg-dark); padding: 12px; border-radius: 8px; border: 1px solid var(--border); margin-bottom: 16px;">
                                <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;">TARGET URL</div>
                                <div id="originalUrlValue" style="font-family: 'JetBrains Mono', monospace; color: var(--accent-primary); word-break: break-all;"></div>
                            </div>
                            <div class="data-grid" id="resultGrid">
                                <!-- Results injected here -->
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Right Column: Trust Score & WHOIS -->
                <div class="right-col">
                    <div class="panel trust-panel" id="domainIntelligence" style="display: none;">
                        <div class="panel-header" style="justify-content: center; border-bottom: none;">
                            <span class="panel-title">Threat Assessment</span>
                        </div>
                        <div class="score-container">
                            <svg width="160" height="160">
                                <circle class="score-ring-bg" cx="80" cy="80" r="70"></circle>
                                <circle class="score-ring" id="scoreCircle" cx="80" cy="80" r="70" stroke-dasharray="440" stroke-dashoffset="440"></circle>
                            </svg>
                            <div class="score-text">
                                <span class="score-number" id="trustScore">0</span>
                                <span class="score-label">Trust Score</span>
                            </div>
                        </div>
                        <div id="riskBadge" class="risk-badge risk-unknown">ANALYZING...</div>
                        <div class="whois-list" id="whoisGrid">
                            <!-- WHOIS data injected here -->
                        </div>
                    </div>
                </div>
            </div>
            <!-- Deep Scan Section (below) -->
            <div class="panel" style="margin-top: 32px;">
                <div class="panel-header">
                    <span class="panel-title">Deep Security Scanner</span>
                </div>
                <div class="search-container">
                    <span class="search-icon">üéØ</span>
                    <input type="text" class="search-input" id="deepScanInput" placeholder="Enter target URL for deep security analysis..." autocomplete="off">
                </div>
                <div class="action-buttons">
                    <button class="btn btn-primary" id="deepScanBtn" style="background: linear-gradient(135deg, #ef4444, #dc2626);">
                        <span>üöÄ</span> Launch Deep Scan
                    </button>
                    <button class="btn btn-secondary" id="deepClearBtn">
                        <span>üóëÔ∏è</span> Clear
                    </button>
                </div>
                <div id="deepError" style="display: none; margin-top: 20px; padding: 12px; background: rgba(239, 68, 68, 0.1); border: 1px solid var(--danger); border-radius: 8px; color: var(--danger); font-size: 14px;"></div>
            </div>
            <div id="deepScanLoading" class="panel scan-loading" style="display: none; margin-top: 20px;">
                <div class="pulse-ring"></div>
                <p class="scan-progress-text">üîç Performing deep security analysis...</p>
                <p style="font-size: 12px; color: var(--text-secondary); margin-top: 10px;">Scanning SSL ‚Ä¢ Security Headers ‚Ä¢ Ports ‚Ä¢ Technology Stack</p>
            </div>
            <div id="deepScanResults" style="display: none; margin-top: 20px;">
                <!-- Security Grade -->
                <div class="security-grade-display">
                    <div id="gradeCircle" class="grade-circle grade-f">F</div>
                    <h3 style="font-size: 18px; margin-bottom: 8px;">Security Score: <span id="securityScoreVal">0</span>/100</h3>
                    <p style="color: var(--text-secondary); font-size: 14px;">Target: <span id="scanTargetDisplay" style="color: var(--accent-primary); font-family: 'JetBrains Mono', monospace;"></span></p>
                    <div class="progress-bar" style="max-width: 300px; margin: 16px auto 0;">
                        <div id="scoreProgressBar" class="progress-fill" style="width: 0%; background: var(--danger);"></div>
                    </div>
                </div>
                <div class="deep-scan-grid">
                    <!-- SSL Analysis Panel -->
                    <div class="scan-panel">
                        <div class="scan-panel-header">
                            <div class="scan-panel-icon icon-ssl">üîí</div>
                            <div>
                                <div class="scan-panel-title">SSL/TLS Certificate</div>
                                <div class="scan-panel-subtitle">Certificate validation & encryption</div>
                            </div>
                        </div>
                        <div id="sslResults">
                            <!-- SSL data injected here -->
                        </div>
                    </div>
                    <!-- Security Headers Panel -->
                    <div class="scan-panel">
                        <div class="scan-panel-header">
                            <div class="scan-panel-icon icon-headers">üõ°Ô∏è</div>
                            <div>
                                <div class="scan-panel-title">Security Headers</div>
                                <div class="scan-panel-subtitle">HTTP security header analysis</div>
                            </div>
                        </div>
                        <div id="headersResults">
                            <!-- Headers data injected here -->
                        </div>
                    </div>
                    <!-- DNS Records Panel -->
                    <div class="scan-panel">
                        <div class="scan-panel-header">
                            <div class="scan-panel-icon icon-dns">üåê</div>
                            <div>
                                <div class="scan-panel-title">DNS Records</div>
                                <div class="scan-panel-subtitle">Domain name system analysis</div>
                            </div>
                        </div>
                        <div id="dnsResults">
                            <!-- DNS data injected here -->
                        </div>
                    </div>
                    <!-- Technology Detection Panel -->
                    <div class="scan-panel">
                        <div class="scan-panel-header">
                            <div class="scan-panel-icon icon-tech">‚öôÔ∏è</div>
                            <div>
                                <div class="scan-panel-title">Technology Stack</div>
                                <div class="scan-panel-subtitle">Server, CMS & framework detection</div>
                            </div>
                        </div>
                        <div id="techResults">
                            <!-- Tech data injected here -->
                        </div>
                    </div>
                    <!-- Open Ports Panel -->
                    <div class="scan-panel">
                        <div class="scan-panel-header">
                            <div class="scan-panel-icon icon-ports">üîå</div>
                            <div>
                                <div class="scan-panel-title">Port Analysis</div>
                                <div class="scan-panel-subtitle">Open ports & services</div>
                            </div>
                        </div>
                        <div id="portsResults">
                            <!-- Ports data injected here -->
                        </div>
                    </div>
                    <!-- Redirect Chain Panel -->
                    <div class="scan-panel">
                        <div class="scan-panel-header">
                            <div class="scan-panel-icon icon-redirect">‚Ü™Ô∏è</div>
                            <div>
                                <div class="scan-panel-title">Redirect Analysis</div>
                                <div class="scan-panel-subtitle">HTTP redirect chain tracking</div>
                            </div>
                        </div>
                        <div id="redirectResults">
                            <!-- Redirect data injected here -->
                        </div>
                    </div>
                    <!-- Findings Panel (Full Width) -->
                    <div class="scan-panel full-width">
                        <div class="scan-panel-header">
                            <div class="scan-panel-icon" style="background: rgba(139, 92, 246, 0.15);">üìã</div>
                            <div>
                                <div class="scan-panel-title">Security Findings</div>
                                <div class="scan-panel-subtitle">Detailed security assessment results</div>
                            </div>
                        </div>
                        <div id="findingsResults" class="findings-list">
                            <!-- Findings injected here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Dashboard View (Empty Placeholder) -->
        <div id="dashboardView" class="view-container">
            <div class="top-bar">
                <div class="page-title">
                    <h2>üìä Dashboard</h2>
                    <p>This page is under construction.</p>
                </div>
            </div>
            <div class="panel" style="text-align: center; padding: 60px;">
                <div style="font-size: 48px; margin-bottom: 20px;">üöß</div>
                <h3 style="color: var(--text-secondary);">Dashboard will be available soon.</h3>
            </div>
        </div>

        <!-- Deep Scan View -->
        <div id="deepscanView" class="view-container">
            <div class="top-bar">
                <div class="page-title">
                    <h2>üî¨ Deep Security Scanner</h2>
                    <p>Comprehensive security analysis ‚Ä¢ SSL ‚Ä¢ Headers ‚Ä¢ Ports ‚Ä¢ Technology</p>
                </div>
                <div class="status-indicator">
                    <div class="status-dot"></div>
                    <span class="status-text">Scanner Ready</span>
                </div>
            </div>

            <div class="panel">
                <div class="panel-header">
                    <span class="panel-title">Target Configuration</span>
                </div>
                
                <div class="search-container">
                    <span class="search-icon">üéØ</span>
                    <input type="text" class="search-input" id="deepScanInput" placeholder="Enter target URL for deep security analysis..." autocomplete="off">
                </div>

                <div class="action-buttons">
                    <button class="btn btn-primary" id="deepScanBtn" style="background: linear-gradient(135deg, #ef4444, #dc2626);">
                        <span>üöÄ</span> Launch Deep Scan
                    </button>
                    <button class="btn btn-secondary" id="deepClearBtn">
                        <span>üóëÔ∏è</span> Clear
                    </button>
                </div>

                <div id="deepError" style="display: none; margin-top: 20px; padding: 12px; background: rgba(239, 68, 68, 0.1); border: 1px solid var(--danger); border-radius: 8px; color: var(--danger); font-size: 14px;"></div>
            </div>

            <!-- Scan Loading -->
            <div id="deepScanLoading" class="panel scan-loading" style="display: none; margin-top: 20px;">
                <div class="pulse-ring"></div>
                <p class="scan-progress-text">üîç Performing deep security analysis...</p>
                <p style="font-size: 12px; color: var(--text-secondary); margin-top: 10px;">Scanning SSL ‚Ä¢ Security Headers ‚Ä¢ Ports ‚Ä¢ Technology Stack</p>
            </div>

            <!-- Deep Scan Results -->
            <div id="deepScanResults" style="display: none; margin-top: 20px;">
                <!-- Security Grade -->
                <div class="security-grade-display">
                    <div id="gradeCircle" class="grade-circle grade-f">F</div>
                    <h3 style="font-size: 18px; margin-bottom: 8px;">Security Score: <span id="securityScoreVal">0</span>/100</h3>
                    <p style="color: var(--text-secondary); font-size: 14px;">Target: <span id="scanTargetDisplay" style="color: var(--accent-primary); font-family: 'JetBrains Mono', monospace;"></span></p>
                    <div class="progress-bar" style="max-width: 300px; margin: 16px auto 0;">
                        <div id="scoreProgressBar" class="progress-fill" style="width: 0%; background: var(--danger);"></div>
                    </div>
                </div>

                <div class="deep-scan-grid">
                    <!-- SSL Analysis Panel -->
                    <div class="scan-panel">
                        <div class="scan-panel-header">
                            <div class="scan-panel-icon icon-ssl">üîí</div>
                            <div>
                                <div class="scan-panel-title">SSL/TLS Certificate</div>
                                <div class="scan-panel-subtitle">Certificate validation & encryption</div>
                            </div>
                        </div>
                        <div id="sslResults">
                            <!-- SSL data injected here -->
                        </div>
                    </div>

                    <!-- Security Headers Panel -->
                    <div class="scan-panel">
                        <div class="scan-panel-header">
                            <div class="scan-panel-icon icon-headers">üõ°Ô∏è</div>
                            <div>
                                <div class="scan-panel-title">Security Headers</div>
                                <div class="scan-panel-subtitle">HTTP security header analysis</div>
                            </div>
                        </div>
                        <div id="headersResults">
                            <!-- Headers data injected here -->
                        </div>
                    </div>

                    <!-- DNS Records Panel -->
                    <div class="scan-panel">
                        <div class="scan-panel-header">
                            <div class="scan-panel-icon icon-dns">üåê</div>
                            <div>
                                <div class="scan-panel-title">DNS Records</div>
                                <div class="scan-panel-subtitle">Domain name system analysis</div>
                            </div>
                        </div>
                        <div id="dnsResults">
                            <!-- DNS data injected here -->
                        </div>
                    </div>

                    <!-- Technology Detection Panel -->
                    <div class="scan-panel">
                        <div class="scan-panel-header">
                            <div class="scan-panel-icon icon-tech">‚öôÔ∏è</div>
                            <div>
                                <div class="scan-panel-title">Technology Stack</div>
                                <div class="scan-panel-subtitle">Server, CMS & framework detection</div>
                            </div>
                        </div>
                        <div id="techResults">
                            <!-- Tech data injected here -->
                        </div>
                    </div>

                    <!-- Open Ports Panel -->
                    <div class="scan-panel">
                        <div class="scan-panel-header">
                            <div class="scan-panel-icon icon-ports">üîå</div>
                            <div>
                                <div class="scan-panel-title">Port Analysis</div>
                                <div class="scan-panel-subtitle">Open ports & services</div>
                            </div>
                        </div>
                        <div id="portsResults">
                            <!-- Ports data injected here -->
                        </div>
                    </div>

                    <!-- Redirect Chain Panel -->
                    <div class="scan-panel">
                        <div class="scan-panel-header">
                            <div class="scan-panel-icon icon-redirect">‚Ü™Ô∏è</div>
                            <div>
                                <div class="scan-panel-title">Redirect Analysis</div>
                                <div class="scan-panel-subtitle">HTTP redirect chain tracking</div>
                            </div>
                        </div>
                        <div id="redirectResults">
                            <!-- Redirect data injected here -->
                        </div>
                    </div>

                    <!-- Findings Panel (Full Width) -->
                    <div class="scan-panel full-width">
                        <div class="scan-panel-header">
                            <div class="scan-panel-icon" style="background: rgba(139, 92, 246, 0.15);">üìã</div>
                            <div>
                                <div class="scan-panel-title">Security Findings</div>
                                <div class="scan-panel-subtitle">Detailed security assessment results</div>
                            </div>
                        </div>
                        <div id="findingsResults" class="findings-list">
                            <!-- Findings injected here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- History View (Placeholder) -->
        <div id="historyView" class="view-container">
            <div class="top-bar">
                <div class="page-title">
                    <h2>üìú Scan History</h2>
                    <p>Previous scan results and analysis records</p>
                </div>
            </div>
            <div class="panel" style="text-align: center; padding: 60px;">
                <div style="font-size: 48px; margin-bottom: 20px;">üöß</div>
                <h3 style="color: var(--text-secondary);">Coming Soon</h3>
                <p style="color: var(--text-secondary); font-size: 14px; margin-top: 8px;">History feature is under development</p>
            </div>
        </div>

        <!-- Settings View (Placeholder) -->
        <div id="settingsView" class="view-container">
            <div class="top-bar">
                <div class="page-title">
                    <h2>‚öôÔ∏è Settings</h2>
                    <p>Configure scanner preferences</p>
                </div>
            </div>
            <div class="panel" style="text-align: center; padding: 60px;">
                <div style="font-size: 48px; margin-bottom: 20px;">üöß</div>
                <h3 style="color: var(--text-secondary);">Coming Soon</h3>
                <p style="color: var(--text-secondary); font-size: 14px; margin-top: 8px;">Settings panel is under development</p>
            </div>
        </div>
    </main>

    <script>
                // ==================== Live Network Analysis (Simulated) ====================
                const liveStats = document.getElementById('liveStats');
                const startLiveBtn = document.getElementById('startLiveBtn');
                let liveInterval = null;
                function randomInt(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }
                function randomIP() {
                    return `${randomInt(10, 250)}.${randomInt(0, 255)}.${randomInt(0, 255)}.${randomInt(1, 254)}`;
                }
                function randomProtocol() {
                    const protos = ['TCP', 'UDP', 'ICMP', 'HTTP', 'HTTPS', 'DNS', 'ARP', 'TLS', 'FTP', 'SSH'];
                    return protos[randomInt(0, protos.length - 1)];
                }
                function randomPort() {
                    const ports = [80, 443, 53, 22, 21, 25, 110, 8080, 3306, 123];
                    return ports[randomInt(0, ports.length - 1)];
                }
                function generateLiveStats() {
                    // Simulate dynamic stats
                    const totalPackets = randomInt(100, 1000);
                    const protocolCounts = {};
                    const portCounts = {};
                    const ipCounts = {};
                    for (let i = 0; i < 8; i++) {
                        const proto = randomProtocol();
                        protocolCounts[proto] = (protocolCounts[proto] || 0) + randomInt(5, 50);
                    }
                    for (let i = 0; i < 8; i++) {
                        const port = randomPort();
                        portCounts[port] = (portCounts[port] || 0) + randomInt(5, 40);
                    }
                    for (let i = 0; i < 8; i++) {
                        const ip = randomIP();
                        ipCounts[ip] = (ipCounts[ip] || 0) + randomInt(1, 20);
                    }
                    // Find top protocol, port, ip
                    function getTop(obj) {
                        return Object.entries(obj).sort((a,b)=>b[1]-a[1]).slice(0,3);
                    }
                    const topProtocols = getTop(protocolCounts);
                    const topPorts = getTop(portCounts);
                    const topIPs = getTop(ipCounts);
                    // Color helpers
                    function colorForProtocol(proto) {
                        if (["HTTP","HTTPS","DNS","TCP","UDP"].includes(proto)) return 'var(--success)';
                        if (["ICMP","TLS","FTP","SSH"].includes(proto)) return 'var(--warning)';
                        return 'var(--danger)';
                    }
                    function colorForPort(port) {
                        port = Number(port);
                        if ([80,443,53,22,21].includes(port)) return 'var(--success)';
                        if (port < 1024) return 'var(--warning)';
                        return 'var(--danger)';
                    }
                    function colorForIP(ip) {
                        // Just highlight the top IP as green, others as yellow
                        return ip === topIPs[0]?.[0] ? 'var(--success)' : 'var(--warning)';
                    }
                    let html = `<div style=\"margin-bottom:10px;\"><b>Total Packets:</b> ${totalPackets}</div>`;
                    html += `<div style=\"margin-bottom:10px;\"><b>Protocols</b> <span title='Types of network traffic detected (e.g., HTTP, DNS, TCP)'>‚ùì</span>:`;
                    html += '<ul>';
                    for (const [proto, count] of topProtocols) {
                        html += `<li style=\"color:${colorForProtocol(proto)}; font-weight:600;\">${proto}: ${count} <span style=\"font-size:12px; color:var(--text-secondary);\">${proto === topProtocols[0][0] ? '(most active)' : ''}</span></li>`;
                    }
                    html += '</ul></div>';
                    html += `<div style=\"margin-bottom:10px;\"><b>Ports</b> <span title='Network ports in use (e.g., 80 for HTTP, 443 for HTTPS)'>‚ùì</span>:`;
                    html += '<ul>';
                    for (const [port, count] of topPorts) {
                        html += `<li style=\"color:${colorForPort(port)}; font-weight:600;\">${port}: ${count} <span style=\"font-size:12px; color:var(--text-secondary);\">${port == topPorts[0][0] ? '(most used)' : ''}</span></li>`;
                    }
                    html += '</ul></div>';
                    html += `<div style=\"margin-bottom:10px;\"><b>IP Addresses</b> <span title='Most active source or destination IPs detected'>‚ùì</span>:`;
                    html += '<ul>';
                    for (const [ip, count] of topIPs) {
                        html += `<li style=\"color:${colorForIP(ip)}; font-weight:600;\">${ip}: ${count} <span style=\"font-size:12px; color:var(--text-secondary);\">${ip == topIPs[0][0] ? '(most active)' : ''}</span></li>`;
                    }
                    html += '</ul></div>';
                    html += `<div style=\"color:var(--text-secondary); font-size:13px; margin-top:10px;\">Green = common/expected, Yellow = uncommon, Red = rare or suspicious.</div>`;
                    liveStats.innerHTML = html;
                }
                if (startLiveBtn) {
                    startLiveBtn.addEventListener('click', () => {
                        liveStats.style.display = 'block';
                        startLiveBtn.style.display = 'none';
                        generateLiveStats();
                        liveInterval = setInterval(generateLiveStats, 2000);
                    });
                }
        // ==================== Navigation ====================
        const navItems = document.querySelectorAll('.nav-item');
        const views = {
            networkanalysis: document.getElementById('networkAnalysisView'),
            dashboard: document.getElementById('dashboardView'),
            history: document.getElementById('historyView'),
            settings: document.getElementById('settingsView')
        };

        navItems.forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                const viewName = item.dataset.view;
                // Update nav active state
                navItems.forEach(nav => nav.classList.remove('active'));
                item.classList.add('active');
                // Show selected view
                Object.values(views).forEach(v => v.classList.remove('active'));
                if (views[viewName]) {
                    views[viewName].classList.add('active');
                }
            });
        });

        // ==================== Network Analysis Functionality ====================
        const urlInput = document.getElementById('urlInput');
        const extractBtn = document.getElementById('extractBtn');
        const clearBtn = document.getElementById('clearBtn');
        const loading = document.getElementById('loading');
        const error = document.getElementById('error');
        const resultContainer = document.getElementById('resultContainer');
        const resultGrid = document.getElementById('resultGrid');
        const originalUrlValue = document.getElementById('originalUrlValue');
        const domainIntelligence = document.getElementById('domainIntelligence');
        const totalScans = document.getElementById('totalScans');
        const successRate = document.getElementById('successRate');

        let stats = { total: 0, successful: 0 };

        function loadStats() {
            const saved = localStorage.getItem('subveil_stats');
            if (saved) {
                stats = JSON.parse(saved);
                updateStatsDisplay();
            }
        }

        function saveStats() {
            localStorage.setItem('subveil_stats', JSON.stringify(stats));
        }

        function updateStatsDisplay() {
            totalScans.textContent = stats.total;
            const rate = stats.total > 0 ? Math.round((stats.successful / stats.total) * 100) : 100;
            successRate.textContent = rate + '%';
        }

        extractBtn.addEventListener('click', async () => {
            const url = urlInput.value.trim();
            if (!url) {
                showError('Please enter a valid URL target.');
                return;
            }

            hideError();
            resultContainer.classList.remove('active');
            domainIntelligence.style.display = 'none';
            loading.classList.add('active');
            extractBtn.disabled = true;

            try {
                const response = await fetch('http://localhost:8000/api/extract', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url: url })
                });

                const data = await response.json();
                stats.total++;

                if (data.success) {
                    stats.successful++;
                    displayResults(url, data.data);
                } else {
                    showError(data.error || 'Extraction failed.');
                }
                saveStats();
                updateStatsDisplay();
            } catch (err) {
                showError('Connection refused. Ensure backend is active on port 8000.');
            } finally {
                loading.classList.remove('active');
                extractBtn.disabled = false;
            }
        });

        clearBtn.addEventListener('click', () => {
            urlInput.value = '';
            hideError();
            resultContainer.classList.remove('active');
            domainIntelligence.style.display = 'none';
            urlInput.focus();
        });

        urlInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') extractBtn.click();
        });

        function showError(msg) {
            error.textContent = '‚ö†Ô∏è ' + msg;
            error.style.display = 'block';
        }

        function hideError() {
            error.style.display = 'none';
        }

        function displayResults(url, data) {
            originalUrlValue.textContent = url;
            resultContainer.classList.add('active');

            if (data.whois && data.whois.available) {
                domainIntelligence.style.display = 'block';
                updateTrustScore(data.whois);
            }

            const fields = [
                { key: 'protocol', label: 'Protocol', icon: 'üîí' },
                { key: 'domain_name', label: 'Domain', icon: 'üåê' },
                { key: 'subdomain', label: 'Subdomain', icon: 'üìÇ' },
                { key: 'tld', label: 'TLD', icon: 'üè∑Ô∏è' },
                { key: 'port', label: 'Port', icon: 'üîå' },
                { key: 'path', label: 'Path', icon: 'üìÅ' },
                { key: 'file_name', label: 'File', icon: 'üìÑ' },
                { key: 'query_params', label: 'Params', icon: '‚ùì' },
                { key: 'ip_address', label: 'IP Address', icon: 'üñ•Ô∏è' },
                { key: 'secure', label: 'SSL/TLS', icon: 'üîê' }
            ];

            resultGrid.innerHTML = '';
            fields.forEach(field => {
                const val = data[field.key] || 'N/A';
                let displayVal = val;
                
                if (field.key === 'secure') {
                    displayVal = val === 'Yes' 
                        ? '<span style="color: var(--success)">‚óè Secure</span>' 
                        : '<span style="color: var(--danger)">‚óè Insecure</span>';
                }

                const card = document.createElement('div');
                card.className = 'data-card';
                card.innerHTML = `
                    <div class="data-label">${field.icon} ${field.label}</div>
                    <div class="data-value">${displayVal}</div>
                `;
                resultGrid.appendChild(card);
            });
        }

        function updateTrustScore(whois) {
            const score = whois.trust_score || 0;
            const scoreCircle = document.getElementById('scoreCircle');
            const trustScoreElement = document.getElementById('trustScore');
            const riskBadge = document.getElementById('riskBadge');
            const whoisGrid = document.getElementById('whoisGrid');

            let currentScore = 0;
            const interval = setInterval(() => {
                if (currentScore >= score) clearInterval(interval);
                else {
                    currentScore++;
                    trustScoreElement.textContent = currentScore;
                }
            }, 10);

            const circumference = 440;
            const offset = circumference - (score / 100) * circumference;
            scoreCircle.style.strokeDashoffset = offset;

            let color = '#ef4444';
            if (score >= 75) color = '#10b981';
            else if (score >= 50) color = '#f59e0b';
            else if (score >= 25) color = '#f97316';
            
            scoreCircle.style.stroke = color;

            const risk = whois.risk_level || 'Unknown';
            riskBadge.textContent = `${risk} RISK`;
            riskBadge.className = `risk-badge risk-${risk.toLowerCase()}`;

            const whoisData = [
                { label: 'Registrar', value: whois.registrar },
                { label: 'Organization', value: whois.organization },
                { label: 'Created', value: whois.creation_date },
                { label: 'Expires', value: whois.expiry_date },
                { label: 'Domain Age', value: whois.domain_age }
            ];

            whoisGrid.innerHTML = '';
            whoisData.forEach(item => {
                const row = document.createElement('div');
                row.className = 'whois-row';
                row.innerHTML = `
                    <span class="whois-key">${item.label}</span>
                    <span class="whois-val">${item.value || 'N/A'}</span>
                `;
                whoisGrid.appendChild(row);
            });
        }

        // ==================== Deep Scan Functionality ====================
        const deepScanInput = document.getElementById('deepScanInput');
        const deepScanBtn = document.getElementById('deepScanBtn');
        const deepClearBtn = document.getElementById('deepClearBtn');
        const deepError = document.getElementById('deepError');
        const deepScanLoading = document.getElementById('deepScanLoading');
        const deepScanResults = document.getElementById('deepScanResults');

        deepScanBtn.addEventListener('click', async () => {
            const url = deepScanInput.value.trim();
            if (!url) {
                showDeepError('Please enter a target URL for deep scanning.');
                return;
            }

            hideDeepError();
            deepScanResults.style.display = 'none';
            deepScanLoading.style.display = 'flex';
            deepScanBtn.disabled = true;

            try {
                const response = await fetch('http://localhost:8000/api/deep-scan', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url: url })
                });

                const data = await response.json();

                if (data.success) {
                    displayDeepScanResults(data);
                    stats.total++;
                    stats.successful++;
                    saveStats();
                    updateStatsDisplay();
                } else {
                    showDeepError(data.error || 'Deep scan failed.');
                }
            } catch (err) {
                showDeepError('Connection refused. Ensure backend is active on port 8000.');
            } finally {
                deepScanLoading.style.display = 'none';
                deepScanBtn.disabled = false;
            }
        });

        deepClearBtn.addEventListener('click', () => {
            deepScanInput.value = '';
            hideDeepError();
            deepScanResults.style.display = 'none';
            deepScanInput.focus();
        });

        deepScanInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') deepScanBtn.click();
        });

        function showDeepError(msg) {
            deepError.textContent = '‚ö†Ô∏è ' + msg;
            deepError.style.display = 'block';
        }

        function hideDeepError() {
            deepError.style.display = 'none';
        }

        function displayDeepScanResults(data) {
            deepScanResults.style.display = 'block';

            // Security Grade
            const grade = data.security_grade || 'F';
            const score = data.security_score || 0;
            const gradeCircle = document.getElementById('gradeCircle');
            const securityScoreVal = document.getElementById('securityScoreVal');
            const scanTargetDisplay = document.getElementById('scanTargetDisplay');
            const scoreProgressBar = document.getElementById('scoreProgressBar');

            gradeCircle.textContent = grade;
            gradeCircle.className = 'grade-circle grade-' + grade.toLowerCase().replace('+', '');
            scanTargetDisplay.textContent = data.target || '';

            // Animate score
            let currentScore = 0;
            const scoreInterval = setInterval(() => {
                if (currentScore >= score) {
                    clearInterval(scoreInterval);
                } else {
                    currentScore++;
                    securityScoreVal.textContent = currentScore;
                    scoreProgressBar.style.width = currentScore + '%';
                }
            }, 15);

            // Color for progress bar
            if (score >= 80) scoreProgressBar.style.background = 'var(--success)';
            else if (score >= 60) scoreProgressBar.style.background = '#22c55e';
            else if (score >= 40) scoreProgressBar.style.background = 'var(--warning)';
            else scoreProgressBar.style.background = 'var(--danger)';

            // SSL Results
            displaySSLResults(data.ssl_analysis);

            // Security Headers Results
            displayHeadersResults(data.security_headers);

            // DNS Results
            displayDNSResults(data.dns_records);

            // Technology Results
            displayTechResults(data.technology);

            // Ports Results
            displayPortsResults(data.open_ports);

            // Redirect Results
            displayRedirectResults(data.redirect_chain);

            // Findings
            displayFindings(data.findings);
        }

        function displaySSLResults(ssl) {
            const container = document.getElementById('sslResults');
            if (!ssl) {
                container.innerHTML = '<p style="color: var(--text-secondary);">No SSL data available</p>';
                return;
            }

            const statusBadge = ssl.enabled && ssl.valid 
                ? '<span class="status-badge badge-success">‚úì Valid</span>'
                : ssl.enabled 
                    ? '<span class="status-badge badge-danger">‚úó Invalid</span>'
                    : '<span class="status-badge badge-warning">Not Enabled</span>';

            container.innerHTML = `
                <div class="scan-row">
                    <span class="scan-key">Status</span>
                    <span class="scan-val">${statusBadge}</span>
                </div>
                <div class="scan-row">
                    <span class="scan-key">Issuer</span>
                    <span class="scan-val">${ssl.issuer || 'N/A'}</span>
                </div>
                <div class="scan-row">
                    <span class="scan-key">Protocol</span>
                    <span class="scan-val">${ssl.protocol || 'N/A'}</span>
                </div>
                <div class="scan-row">
                    <span class="scan-key">Cipher</span>
                    <span class="scan-val">${ssl.cipher || 'N/A'}</span>
                </div>
                <div class="scan-row">
                    <span class="scan-key">Expires</span>
                    <span class="scan-val">${ssl.expires || 'N/A'} ${ssl.days_until_expiry ? `(${ssl.days_until_expiry} days)` : ''}</span>
                </div>
            `;
        }

        function displayHeadersResults(headers) {
            const container = document.getElementById('headersResults');
            if (!headers) {
                container.innerHTML = '<p style="color: var(--text-secondary);">No headers data available</p>';
                return;
            }

            const headersList = headers.headers || {};
            let html = `
                <div class="scan-row">
                    <span class="scan-key">Score</span>
                    <span class="scan-val">${headers.present_count || 0}/${headers.total_headers || 0} headers present</span>
                </div>
                <div class="progress-bar" style="margin-bottom: 16px;">
                    <div class="progress-fill" style="width: ${headers.score || 0}%; background: ${headers.score >= 60 ? 'var(--success)' : headers.score >= 40 ? 'var(--warning)' : 'var(--danger)'};"></div>
                </div>
            `;

            const importantHeaders = ['Strict-Transport-Security', 'Content-Security-Policy', 'X-Frame-Options', 'X-Content-Type-Options'];
            importantHeaders.forEach(name => {
                const h = headersList[name];
                if (h) {
                    const icon = h.present 
                        ? '<div class="header-check-icon check-pass">‚úì</div>'
                        : '<div class="header-check-icon check-fail">‚úó</div>';
                    html += `<div class="header-check">${icon} <span>${name}</span></div>`;
                }
            });

            container.innerHTML = html;
        }

        function displayDNSResults(dns) {
            const container = document.getElementById('dnsResults');
            if (!dns) {
                container.innerHTML = '<p style="color: var(--text-secondary);">No DNS data available</p>';
                return;
            }

            container.innerHTML = `
                <div class="scan-row">
                    <span class="scan-key">A Records (IPv4)</span>
                    <span class="scan-val">${(dns.a_records || []).join(', ') || 'None'}</span>
                </div>
                <div class="scan-row">
                    <span class="scan-key">AAAA (IPv6)</span>
                    <span class="scan-val">${(dns.aaaa_records || []).slice(0, 2).join(', ') || 'None'}</span>
                </div>
                <div class="scan-row">
                    <span class="scan-key">MX Records</span>
                    <span class="scan-val">${(dns.mx_records || []).slice(0, 2).join(', ') || 'N/A'}</span>
                </div>
                <div class="scan-row">
                    <span class="scan-key">Name Servers</span>
                    <span class="scan-val">${(dns.ns_records || []).slice(0, 2).join(', ') || 'N/A'}</span>
                </div>
            `;
        }

        function displayTechResults(tech) {
            const container = document.getElementById('techResults');
            if (!tech) {
                container.innerHTML = '<p style="color: var(--text-secondary);">No technology data available</p>';
                return;
            }

            let techTags = '';
            (tech.detected || []).forEach(item => {
                techTags += `<span class="tech-tag">${item}</span>`;
            });

            container.innerHTML = `
                <div class="scan-row">
                    <span class="scan-key">Server</span>
                    <span class="scan-val">${tech.server || 'Unknown'}</span>
                </div>
                <div class="scan-row">
                    <span class="scan-key">CMS</span>
                    <span class="scan-val">${tech.cms || 'Not detected'}</span>
                </div>
                <div class="scan-row">
                    <span class="scan-key">CDN</span>
                    <span class="scan-val">${tech.cdn || 'Not detected'}</span>
                </div>
                ${techTags ? `<div style="margin-top: 12px;">${techTags}</div>` : ''}
            `;
        }

        function displayPortsResults(ports) {
            const container = document.getElementById('portsResults');
            if (!ports) {
                container.innerHTML = '<p style="color: var(--text-secondary);">No port data available</p>';
                return;
            }

            const openPorts = ports.open_ports || [];
            const safePorts = [80, 443];

            let portTags = '';
            openPorts.forEach(p => {
                const isSafe = safePorts.includes(p.port);
                portTags += `<span class="port-tag ${isSafe ? 'safe' : ''}">${p.port} (${p.service})</span>`;
            });

            container.innerHTML = `
                <div class="scan-row">
                    <span class="scan-key">Open Ports</span>
                    <span class="scan-val">${openPorts.length} found</span>
                </div>
                <div class="scan-row">
                    <span class="scan-key">Scanned</span>
                    <span class="scan-val">${ports.scanned || 0} common ports</span>
                </div>
                ${portTags ? `<div style="margin-top: 12px;">${portTags}</div>` : '<p style="color: var(--text-secondary); font-size: 12px; margin-top: 10px;">No open ports detected</p>'}
            `;
        }

        function displayRedirectResults(redirects) {
            const container = document.getElementById('redirectResults');
            if (!redirects) {
                container.innerHTML = '<p style="color: var(--text-secondary);">No redirect data available</p>';
                return;
            }

            const httpsUpgrade = redirects.https_upgrade 
                ? '<span class="status-badge badge-success">‚úì Yes</span>'
                : '<span class="status-badge badge-warning">‚úó No</span>';

            container.innerHTML = `
                <div class="scan-row">
                    <span class="scan-key">Redirects</span>
                    <span class="scan-val">${redirects.count || 0} hop(s)</span>
                </div>
                <div class="scan-row">
                    <span class="scan-key">HTTPS Upgrade</span>
                    <span class="scan-val">${httpsUpgrade}</span>
                </div>
                <div class="scan-row">
                    <span class="scan-key">Final URL</span>
                    <span class="scan-val" style="font-size: 11px;">${redirects.final_url || 'N/A'}</span>
                </div>
            `;
        }

        function displayFindings(findings) {
            const container = document.getElementById('findingsResults');
            if (!findings || findings.length === 0) {
                container.innerHTML = '<p style="color: var(--text-secondary);">No findings to report</p>';
                return;
            }

            container.innerHTML = '';
            findings.forEach(finding => {
                const icon = {
                    success: '‚úì',
                    warning: '‚ö†',
                    danger: '‚úó',
                    info: '‚Ñπ'
                }[finding.type] || '‚Ñπ';

                const item = document.createElement('div');
                item.className = `finding-item finding-${finding.type}`;
                item.innerHTML = `<span>${icon}</span> ${finding.message}`;
                container.appendChild(item);
            });
        }

        // ==================== Initialize ====================
        window.addEventListener('load', () => {
            loadStats();
            urlInput.focus();
        });
    </script>
</body>
</html>